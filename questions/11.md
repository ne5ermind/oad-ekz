# Методы выявления аномалий. Изоляционный лес: назначение, алгоритм реализации, пример визуализации результатов

Выявление аномалий — это задача поиска объектов, которые существенно отклоняются от общего распределения данных

### Основные методы:
1.  **Ящик с усами (Box Plot)** — статистический метод, основанный на межквартильном размахе
2.  **Изоляционный лес (Isolation Forest)** — алгоритм машинного обучения, основанный на структуре деревьев

---

## Изоляционный лес (Isolation Forest)

Изоляционный лес — эффективный алгоритм выявления аномалий, который базируется на двух ключевых свойствах выбросов:
*   Они составляют меньшинство в выборке
*   Они обладают сильно отличающимися значениями признаков

### Области применения
Алгоритм широко используется в 2026 году для решения таких задач, как:
*   Выявление мошенничества в банковских транзакциях (антифрод)
*   Обнаружение вторжений в сетевой безопасности
*   Мониторинг состояния промышленного оборудования (предиктивная аналитика)
*   Поиск ошибок в данных перед обучением моделей

---

### Алгоритм реализации

Процесс работы алгоритма делится на три этапа:

#### А) Построение дерева (iTree)
1.  Из исходного набора данных выбирается случайная подвыборка
2.  Выбирается случайный признак
3.  Выбирается случайное значение («порог») для разделения в диапазоне между минимальным и максимальным значением этого признака
4.  Данные делятся на две части: те, что меньше порога, и те, что больше
5.  Процесс рекурсивно повторяется для каждой части, пока в узле не останется **всего один объект** или пока не будет достигнута заданная глубина

#### Б) Изоляция
*   **Аномалии:** обычно находятся на периферии признакового пространства. Для их отделения требуется мало случайных разделений, поэтому в дереве такая точка имеет короткий путь от корня
*   **Нормальные точки:** сгруппированы плотно. Чтобы изолировать точку внутри такого кластера, требуется много разделений, что дает длинный путь от корня

#### В) Лес (iForest)
Построения одного дерева недостаточно для точности, поэтому строится «лес» из множества деревьев (обычно 100 и более). Итоговый результат — средняя длина пути от корня до объекта по всем деревьям леса. Чем короче средний путь, тем выше вероятность, что объект является аномалией.

> [!NOTE]
> Пример реализации алгоритма: `../scripts/iso-forest.py`

---

### Визуализация результатов

Для двумерных массивов данных визуализация должна отображать «области доверия» модели

**Метод отрисовки:**
1.  Создается сетка (grid) координат, покрывающая пространство признаков
2.  Для каждой точки на сетке модель рассчитывает оценку аномальности (*score*)
3.  Отрисовываются зоны интенсивности (тепловая карта), где цветом выделяются области нормальных данных и области аномалий

> [!NOTE]
> Пример кода для визуализации зон интенсивности: `../scripts/iso-forest-vsualisation.py`

