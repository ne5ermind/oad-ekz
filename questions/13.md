# Типы данных при обработке массива данных в pandas. Работа с датами. Задача обогощения массива данных новыми принзаками

## 1. Типы данных

| Тип в Pandas | Описание | Пример |
| :--- | :--- | :--- |
| int64 / int32 | Целые числа | 19, 84 |
| float64 | Число с плавающей точкой | 1.337, 2.0 |
| bool | Логическое значение | True, False |
| object | Текст или смешанные типы | 'привет бедолаги', 'кто в миите' |
| category | Категориальные данные | 'тип вагона', 'станция' |
| datetime64 | Дата и время | `2001-09-11 9:00` |
| timedelta64 | Разница по времени | `2 days 06:09:42` |

> [!TIP]
> Для проверки типа данных используется df.info()

## 2. Работа с датами
Дата в Pandas - объект, который обладает полезными признаками 

#### Преобразование в дату:

```python
import pandas as pd

df['date'] = pd.to_datetime(df['date'], format='%d.%m.%Y')
```

#### Извлечение компонентов:
Аттрибут `.dt` дает получить доступ к любой части даты

```python
df['Год'] = df['Дата'].dt.year
df['Месяц'] = df['Дата'].dt.month
df['День_недели'] = df['Дата'].dt.dayofweek  # 0 - Понедельник, 6 - Воскресенье
df['Выходной'] = df['Дата'].dt.dayofweek >= 5 # Булевый признак
```

#### Вычисления с датами

```python
# Расчет длительности процесса 
df['Время_в_пути'] = df['Прибытие'] - df['Отправление']

# Получение разницы в днях (целым числом)
df['Дней_простоя'] = (pd.Timestamp.now() - df['Дата_отгрузки']).dt.days
```

## 3. Обогащение массива новыми признаками
Обогащение - процесс создания новых столбцов на основе существующих для повышения точности анализа или моделей 

#### А) Создание признаков на основе условий
Метод `np.where` или функция `map()` позволяют быстро классифицировать данные

```python
import numpy as np

# классификаия веса груза
df['Категория веса'] = np.where(df['Вес'] > 60, 'Тяжеловесный', 'Стандартный')
```

#### Б) Агрегация данных
Позволяет добавить контекст всей выборки к каждой конкретной строке (например, среднее значение по группе)

```python
# Добавление колонки со средним весом по станции
df['Средний_вес_станции'] = df.groupby('Станция')['Вес'].transform('mean')
```

#### В) Обогащение из внешних источников
Объединение основной таблицы со справочником

```python
df = df.merge(reference_df, on='id_станции', how='left')
```

#### Г) Смещение и разница (shift / diff)

```python
# Значение объема на предыдущем шаге
df['Предыдущий_объем'] = df['Объем'].shift(1)

# Прирост объема относительно предыдущего дня
df['Прирост'] = df['Объем'].diff()
```
